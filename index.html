<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashie Dashboard</title>

  <!-- Dashboard Module CSS -->
  <link rel="stylesheet" href="./css/modules/dashboard.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <!-- Dashboard renders here full-screen -->

  <!-- Core JavaScript Modules -->
  <script type="module">
    import { createLogger } from './js/utils/logger.js';
    import consoleCommands from './js/utils/console-commands.js';
    import AppComms from './js/core/app-comms.js';
    import AppStateManager from './js/core/app-state-manager.js';
    import InputHandler from './js/core/input-handler.js';
    import ActionRouter from './js/core/action-router.js';
    import WidgetMessenger from './js/core/widget-messenger.js';
    import { getPlatformDetector } from './js/utils/platform-detector.js';
    import Dashboard from './js/modules/Dashboard/dashboard.js';
    import DashboardInputHandler from './js/modules/Dashboard/dashboard-input-handler.js';

    const logger = createLogger('Main');

    // Initialize console commands (for debugging)
    consoleCommands.initialize();

    // Initialize core components
    async function initializeCore() {
      try {
        logger.info('Starting core initialization...');

        // Initialize AppStateManager
        await AppStateManager.initialize();
        logger.success('AppStateManager initialized');

        // Initialize InputHandler
        await InputHandler.initialize();
        logger.success('InputHandler initialized');

        // Initialize ActionRouter
        await ActionRouter.initialize();
        logger.success('ActionRouter initialized');

        // Initialize WidgetMessenger
        await WidgetMessenger.initialize();
        logger.success('WidgetMessenger initialized');

        // Initialize Dashboard module
        await Dashboard.initialize();
        logger.success('Dashboard module initialized');

        // Register Dashboard with ActionRouter
        ActionRouter.registerModule('dashboard', DashboardInputHandler);
        logger.success('Dashboard module registered with ActionRouter');

        // Set Dashboard as active module
        AppStateManager.setCurrentModule('dashboard');
        logger.success('Dashboard set as current module');

        // Activate Dashboard
        Dashboard.activate();
        logger.success('Dashboard activated');

        // Detect platform
        const platform = getPlatformDetector();
        logger.info('Platform detected', { platform: platform.getPlatformDescription() });

        logger.success('Core initialization complete');

      } catch (error) {
        logger.error('Core initialization failed', error);
      }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', initializeCore);
  </script>
</body>
</html>
